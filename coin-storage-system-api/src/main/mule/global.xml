<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
  xmlns:secure-properties="http://www.mulesoft.org/schema/mule/secure-properties" xmlns:http="http://www.mulesoft.org/schema/mule/http"
  xmlns:apikit-soap="http://www.mulesoft.org/schema/mule/apikit-soap"
  xmlns:mongo="http://www.mulesoft.org/schema/mule/mongo" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/mongo http://www.mulesoft.org/schema/mule/mongo/current/mule-mongo.xsd
http://www.mulesoft.org/schema/mule/apikit-soap http://www.mulesoft.org/schema/mule/apikit-soap/current/mule-apikit-soap.xsd
http://www.mulesoft.org/schema/mule/secure-properties http://www.mulesoft.org/schema/mule/secure-properties/current/mule-secure-properties.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
  <http:listener-config name="api-httpListenerConfig">
        <http:listener-connection host="0.0.0.0" port="8081"/>
    </http:listener-config>
  <apikit-soap:config name="soapkit-config" doc:name="APIKit for SOAP Configuration" doc:id="bb3d3cc4-ab12-4b56-a60b-c73d65f4b601" wsdlLocation="CoinStorageService.wsdl" service="CoinStorageService" port="CoinStorageServiceSOAP"/>
  <configuration-properties doc:name="Configuration properties" doc:id="521e2197-121e-430e-a0a6-a257061bf8ec" file="config\local-decrypt-properties.yaml" />
  <mongo:config name="MongoDB_Config" doc:name="MongoDB Config" doc:id="f0274f98-aed2-4221-a095-00029fc1a13d" >
    <mongo:connection-string-connection connectionString="mongodb+srv://vfrcbv2142:vfrcbv2142@cluster0.6tkgj.mongodb.net/myFirstDatabase?retryWrites=true&amp;w=majority" />
  </mongo:config>
  <configuration doc:name="Configuration" doc:id="4522c2f5-b42e-4dcc-b805-41818ac03264" defaultErrorHandler-ref="globalErrorHandler" />
  <error-handler name="globalErrorHandler" doc:id="d468bd87-245e-4bde-b466-b60130197e82" >
    <on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="27f6a016-7498-4b9d-9036-46707b3185fe" type="HTTP:BAD_REQUEST, XML-MODULE:SCHEMA_NOT_HONOURED, VALIDATION:NULL">
      <ee:transform doc:name="400 error + httpStatus" doc:id="ac302172-5208-4dd6-86c8-c3cbf0e3328f" >
        <ee:message >
          <ee:set-payload ><![CDATA[%dw 2.0
output application/xml
---
fault:{
  statusCode: 400,
  errorType: (error.errorType.namespace default "HTTP") ++ ":" 
  ++ (error.errorType.identifier default "BAD_REQUEST"),
  description: error.description,
  date: now()
}]]></ee:set-payload>
        </ee:message>
        <ee:variables >
          <ee:set-variable variableName="httpStatus" ><![CDATA[400]]></ee:set-variable>
        </ee:variables>
      </ee:transform>
    </on-error-propagate>
    <on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="afd98492-12d8-4d72-99f8-bf5522ed6563" type="HTTP:UNAUTHORIZED">
      <ee:transform doc:name="401 error + httpStatus" doc:id="0fa5731b-71f3-455e-ac04-5b6d4c681ff5" >
        <ee:message >
          <ee:set-payload ><![CDATA[%dw 2.0
output application/xml
---
fault:{
  statusCode: 401,
  errorType: (error.errorType.namespace default "HTTP") ++ ":" 
  ++ (error.errorType.identifier default "UNAUTHORIZED"),
  description: error.description,
  date: now()
}]]></ee:set-payload>
        </ee:message>
        <ee:variables >
          <ee:set-variable variableName="httpStatus" ><![CDATA[401]]></ee:set-variable>
        </ee:variables>
      </ee:transform>
    </on-error-propagate>
    <on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="c9698711-eb8d-4a91-bb5d-da49c2cee731" type="HTTP:FORBIDDEN">
      <ee:transform doc:name="403 error + httpStatus" doc:id="5d596761-428f-49d7-9b32-e18a327b1e1d" >
        <ee:message >
          <ee:set-payload ><![CDATA[%dw 2.0
output application/xml
---
fault:{
  statusCode: 403,
  errorType: (error.errorType.namespace default "HTTP") ++ ":" 
  ++ (error.errorType.identifier default "FORBIDDEN"),
  description: error.description,
  date: now()
}]]></ee:set-payload>
        </ee:message>
        <ee:variables >
          <ee:set-variable variableName="httpStatus" ><![CDATA[403]]></ee:set-variable>
        </ee:variables>
      </ee:transform>
    </on-error-propagate>
    <on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="d0f45109-b482-44db-a1a0-ae1e2cc9e217" type="HTTP:NOT_FOUND">
      <ee:transform doc:name="404 error + httpStatus" doc:id="9cd6b72d-e17f-484a-8a68-23806b2f1bfe" >
        <ee:message >
          <ee:set-payload ><![CDATA[%dw 2.0
output application/xml
---
fault:{
  statusCode: 404,
  errorType: (error.errorType.namespace default "HTTP") ++ ":" 
  ++ (error.errorType.identifier default "NOT_FOUND"),
  description: error.description,
  date: now()
}]]></ee:set-payload>
        </ee:message>
        <ee:variables >
          <ee:set-variable variableName="httpStatus" ><![CDATA[404]]></ee:set-variable>
        </ee:variables>
      </ee:transform>
    </on-error-propagate>
    <on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="f92f737f-3098-4a09-919e-b93a89f4f6d6" type="HTTP:TIMEOUT">
      <ee:transform doc:name="408 error + httStatus" doc:id="969be07c-2c91-440d-9279-1ae98c3ae730" >
        <ee:message >
          <ee:set-payload ><![CDATA[%dw 2.0
output application/xml
---
fault:{
  statusCode: 404,
  errorType: (error.errorType.namespace default "HTTP") ++ ":" 
  ++ (error.errorType.identifier default "TIMEOUT"),
  description: error.description,
  date: now()
}]]></ee:set-payload>
        </ee:message>
        <ee:variables >
          <ee:set-variable variableName="httpStatus" ><![CDATA[408]]></ee:set-variable>
        </ee:variables>
      </ee:transform>
    </on-error-propagate>
    <on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="ad029b21-977c-4035-81d9-cd3c0dc8ec47" type="HTTP:TOO_MANY_REQUESTS">
      <ee:transform doc:name="429 error + httpStatus" doc:id="cb61e61f-cc26-4fa5-824b-97fc7907ace0" >
        <ee:message >
          <ee:set-payload ><![CDATA[%dw 2.0
output application/xml
---
fault:{
  statusCode: 429,
  errorType: (error.errorType.namespace default "HTTP") ++ ":" 
  ++ (error.errorType.identifier default "TOO_MANY_REQUESTS"),
  description: error.description,
  date: now()
}]]></ee:set-payload>
        </ee:message>
        <ee:variables >
          <ee:set-variable variableName="httpStatus" ><![CDATA[429]]></ee:set-variable>
        </ee:variables>
      </ee:transform>
    </on-error-propagate>
    <on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="21ea513b-0c8f-41bc-9d02-e708335b5001" type="HTTP:INTERNAL_SERVER_ERROR">
      <ee:transform doc:name="500 error + httpStatus" doc:id="2a095095-e788-4e44-83ea-2096215b042c" >
        <ee:message >
          <ee:set-payload ><![CDATA[%dw 2.0
output application/xml
---
fault:{
  statusCode: 500,
  errorType: (error.errorType.namespace default "HTTP") ++ ":" 
  ++ (error.errorType.identifier default "INTERNAL_SERVER_ERROR"),
  description: error.description,
  date: now()
}]]></ee:set-payload>
        </ee:message>
        <ee:variables >
          <ee:set-variable variableName="htppStatus" ><![CDATA[500]]></ee:set-variable>
        </ee:variables>
      </ee:transform>
    </on-error-propagate>
    <on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="01b2a79b-044d-4810-8795-c9d664d09bab" type="ANY">
      <ee:transform doc:name="unknown error + httpStatus" doc:id="07a2e5ea-9e96-4fde-84ef-b0df58f72b95" >
        <ee:message >
          <ee:set-payload ><![CDATA[%dw 2.0
output application/xml
---
fault:{
  statusCode: error.muleMessage.attributes.StatusCode default 500,
  errorType: (error.errorType.namespace default "HTTP") ++ ":" 
  ++ (error.errorType.identifier default "INTERNAL_SERVER_ERROR"),
  description: error.description,
  date: now()
}]]></ee:set-payload>
        </ee:message>
        <ee:variables >
          <ee:set-variable variableName="htppStatus" ><![CDATA[error.muleMessage.attributes.StatusCode default 500]]></ee:set-variable>
        </ee:variables>
      </ee:transform>
    </on-error-propagate>

  </error-handler>
</mule>